<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Missions - CrimeLords</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="container glassmorphic">
    <header class="header">
      <h1><i class="fa-solid fa-gun"></i> Missions</h1>
    </header>

    <section class="missions">
      <label for="mission-select">Choose Mission:</label>
      <select id="mission-select"></select>

      <div id="tasks"></div>
    </section>
  </div>

  <script>
    const missionsData = [];
    const unlockedMissions = JSON.parse(localStorage.getItem('unlockedMissions')) || 1;
    const cashElem = document.getElementById('cash');
    const xpElem = document.getElementById('xp');

    // Create 10 missions with 10 submissions each
    for (let m = 1; m <= 10; m++) {
      const mission = {
        name: `Mission ${m}`,
        unlocked: m <= unlockedMissions,
        tasks: []
      };
      for (let t = 1; t <= 10; t++) {
        mission.tasks.push({
          id: t,
          name: `Task ${t}`,
          xp: m * 10 + t * 2,
          cash: m * 20 + t * 5,
          energy: 5 + t
        });
      }
      missionsData.push(mission);
    }

    const missionSelect = document.getElementById('mission-select');
    const tasksDiv = document.getElementById('tasks');

    // Populate dropdown
    function populateDropdown() {
      missionSelect.innerHTML = '';
      missionsData.forEach((m, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = m.unlocked ? m.name : `${m.name} (Locked)`;
        opt.disabled = !m.unlocked;
        missionSelect.appendChild(opt);
      });
    }

    function showTasks(index) {
      const mission = missionsData[index];
      if (!mission.unlocked) return;

      tasksDiv.innerHTML = '';
      mission.tasks.forEach(task => {
        const btn = document.createElement('button');
        btn.textContent = `${task.name} — XP: ${task.xp}, Cash: $${task.cash}, Energy: ${task.energy}`;
        btn.className = 'task-btn';
        btn.onclick = () => {
          const currentEnergy = parseInt(localStorage.getItem('energy')) || 100;
          if (currentEnergy < task.energy) {
            alert("Not enough energy!");
            return;
          }

          // Reduce energy
          localStorage.setItem('energy', currentEnergy - task.energy);

          // Add cash & XP
          let cash = parseInt(localStorage.getItem('cash') || '100');
          let xp = parseInt(localStorage.getItem('xp') || '0');
          cash += task.cash;
          xp += task.xp;
          localStorage.setItem('cash', cash);
          localStorage.setItem('xp', xp);

          btn.disabled = true;
          btn.textContent += ' ✅';

          // If all tasks complete, unlock next mission
          if ([...tasksDiv.querySelectorAll('button')].every(b => b.disabled)) {
            if (index + 1 < missionsData.length && !missionsData[index + 1].unlocked) {
              missionsData[index + 1].unlocked = true;
              localStorage.setItem('unlockedMissions', index + 2);
              alert(`${missionsData[index + 1].name} Unlocked!`);
              populateDropdown();
            }
          }
        };
        tasksDiv.appendChild(btn);
      });
    }

    // Initial setup
    populateDropdown();
    missionSelect.addEventListener('change', (e) => {
      showTasks(parseInt(e.target.value));
    });
    showTasks(0); // Show Mission 1 by default
  </script>
</body>
</html>
