<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Missions - Crime Lords</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="container glassmorphic">
    <!-- Header + Navbar -->
    <div id="header-placeholder"></div>

    <section class="missions">
      <h2><i class="fa-solid fa-gun"></i> Missions</h2>

      <!-- Mission Dropdown -->
      <select id="missionSelect" onchange="loadMission()" class="task-btn"></select>

      <!-- Mission Tasks -->
      <div id="taskList" class="task-list"></div>
    </section>
  </div>

  <script src="script.js"></script>
  <script>
    // Header + navbar load with active link
    fetch("header.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("header-placeholder").innerHTML = data;
        const currentPage = window.location.pathname.split("/").pop();
        document.querySelectorAll("#nav-bar a").forEach(link => {
          if (link.getAttribute("href") === currentPage) {
            link.classList.add("active");
          }
        });
      });

    // Mission Data
    const missions = Array.from({ length: 10 }, (_, i) => ({
      id: i + 1,
      name: `Mission ${i + 1}`,
      energyCost: 5 + i * 2,
      baseXP: 10 + i * 5,
      baseCash: 20 + i * 10
    }));

    // Initialize unlock progress
    if (!localStorage.getItem("missionUnlock")) {
      localStorage.setItem("missionUnlock", "1");
    }

    // Load dropdown
    function loadMissionsDropdown() {
      const unlocked = parseInt(localStorage.getItem("missionUnlock")) || 1;
      const select = document.getElementById("missionSelect");
      select.innerHTML = "";

      missions.forEach(m => {
        const option = document.createElement("option");
        option.value = m.id;
        option.textContent = m.name + (m.id > unlocked ? " (Locked)" : "");
        option.disabled = m.id > unlocked;
        select.appendChild(option);
      });

      loadMission(); // Load the default mission
    }

    // Load mission tasks
    function loadMission() {
      const missionId = parseInt(document.getElementById("missionSelect").value);
      const taskList = document.getElementById("taskList");
      taskList.innerHTML = "";

      const mission = missions.find(m => m.id === missionId);

      for (let i = 1; i <= 10; i++) {
        const task = document.createElement("button");
        task.className = "task-btn";
        task.textContent = `Submission ${i} - Energy: ${mission.energyCost}, XP: ${mission.baseXP * i}, $${mission.baseCash * i}`;
        task.onclick = () => runMission(mission, i);
        taskList.appendChild(task);
      }
    }

    // Run a mission submission
    function runMission(mission, count) {
      const energy = parseInt(localStorage.getItem("energy")) || 0;
      const xp = parseInt(localStorage.getItem("xp")) || 0;
      const cash = parseInt(localStorage.getItem("cash")) || 0;

      if (energy < mission.energyCost) {
        alert("Not enough energy!");
        return;
      }

      localStorage.setItem("energy", energy - mission.energyCost);
      localStorage.setItem("xp", xp + mission.baseXP * count);
      localStorage.setItem("cash", cash + mission.baseCash * count);

      // Unlock next mission if all 10 submissions are done
      const unlocked = parseInt(localStorage.getItem("missionUnlock")) || 1;
      if (mission.id === unlocked && count === 10 && unlocked < 10) {
        localStorage.setItem("missionUnlock", unlocked + 1);
        alert(`ðŸŽ‰ ${mission.name} completed! Mission ${unlocked + 1} unlocked!`);
        loadMissionsDropdown();
      }

      updateStats(); // From script.js
    }

    loadMissionsDropdown();
  </script>
</body>
</html>
